package cn.zzh.demo.queue.producer;

import com.alibaba.fastjson.JSON;
import org.apache.kafka.clients.producer.KafkaProducer;
import org.apache.kafka.clients.producer.Producer;
import org.apache.kafka.clients.producer.ProducerRecord;
import org.apache.kafka.clients.producer.RecordMetadata;

import java.util.Properties;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.Future;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.TimeoutException;

public class ProducerServer {

    public static void main(String[] args) {



        Properties props = new Properties();
        props.put("bootstrap.servers", "172.17.12.143:9092");
//        props.put("acks", "all");
//        props.put("retries", 0);
//        props.put("batch.size", 16384);
//        props.put("linger.ms", 1);
//        props.put("buffer.memory", 33554432);
        props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
        props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");

        String topic = "lz_statagent_info";
        String msg = "2018-06-14 07:05:07.880`postEvent`addr=125.73.220.99, 183.3.229.169`{\"deviceid\":\"99001006090817\",\"appkey\":\"17c554e03c2f5332138af15133abdf9e\",\"userid\":\"2633520661410021420\",\"session\":\"B3B5BF8BAF8449FA97A9E20778E1D9D5\",\"time\":\"2018-06-14 07:05:03.376\",\"eventid\":\"EVNET_DEVICE_INFO_UPLOAD\",\"view\":\".launcher.Launcher\",\"label\":{\"key_version\":4,\"content\":\"0AE983737955CB2D8F1EB0B03D2B60178189AFCF3D475A1EE93F8F1969C7599F9EC9F9B6AB5D5F00A6CE36791297D846BC60772CBCA4F73EA8030C026770EFDC271059369B1A660E31E4ECF5CD10AC9FC5C1611FA165A5D31AD8C44F2B20D4A4F5DCD831588DED556DA58213F5F41C97170EF0ACD6EAEC12434E921C42EBE8D725408A4B54D1D6E38F3B50D0D8B74E9DAB90546B2D428A389BAFAF5B9AA8FA2281120125DC35486501F8D773B483232DCCC9602451DABC9788737B9BADF708475F70A56C297AC98C10E6FAF4D2D1B40614063204F664D5A60C225D2221F5CDB4BCB7EB3915F9E99CC48BE94280076DFE7BDEB0B4E673589CD5B68E1AC643F49417F17535BD6C7DA98218B8322B33BFC3923E856BC4B45F9A6879D0AB916DF1584B488A9B5C597E3825B4029B7B899348C0695129861ABF1C8941795FE8FAB63E8EE20349A6DCA32B86D789CD509902D104F84BF6C24FC1AFF2F1BA696777DC84ADCA17E49C5EC195F1FD7275ADB12BDA014969DD13ABD0D5998239669EA95E937B833765C5305C26B4E10C7D953AE2968A7D0794BD6A7667BD1D54559D9B2C071FD2238DBE623710A13D44C877E3AACA51596ACF3E60B1F7E9ABF8E1477FF0559B3E6B3D806272E72FB52A467ABEA8552D3DDE30BAEFCA1F7914BE8FAB1938292E82B2241274FC111EA580DBAD3743D309F6C615F1D7AD49E1CA08885CDC749D5A78A2326B61D3C84144E1B822BE40B47D8B11A800B8E9E35D5D8DBD72A43E3808E621C5D13718CBD99902F664A44AA2B91E4889CA16E4ACC17083C90264CC76EF189EBC0FCB02F82A2962BC9AE0D30ED05C56D081362C21D933B4D3492F4E5B48A0A734C9571C8274D6B0E05765AA77169FDCD3EF3FCCAE80CBFFA4360D9C34239BE804B22FB4F8696DE28BD253E7777885DB26B93372881BE638071DB32CF061EAAAC6B8AF6FCB191754ED9863FCF9013938EC0483F8DB3165EDB7B5D06DDA3A239DEC16698441CE8A59D1D2D64EBF8C19EABC6C3BEA6DBB98B8134B3D61FC1249B6D3DBCD358EE47D2AA42BDF53D505A0AE7B3EFDF85C3352AE1B5BCA3DD61A359DB2CF5017DEF3D8716D2F638D9149174992384355ECF6630F68455D1AFB0BCD1E11364362F1447E93901546923AC2EE230175821316F3487FE48953517EC1C35287685D0DE3989A1F97009DAE4F8843CC820F57AB1D7B9A0875AB6EA0ED15E9D77D2CE816F72C3463C5BDA393B4B392244DD4772436B0C2109A85CD590B7DA33C499A14D7E142EACC4BF45CE1A55EE4349E0AD270FFFD476F1C003AD17F35E271AD50066C2576E0023671A6CB0D1E0837FA9EBD34CD1F649027A96DDC297549A3CD2CC9ACCF4F79022E44E619A66EC2DC39D88D2E440393F317CACB98997E868A5B372B9F3F06EA97F004524FAAF581FB6ECF255E0962F9EE4B5CD3013E1C1A282CF50B575F0F88378A57E0F5277516D1D5C9A2D15B6D4536DA50BD5FB142D4FAEC32F9825399FED68249D72703EFDA74F4A047C4A14C6C4255DEE4C6B5AD3C1C41F8294731BC4DB0A4F9636C2A136A2B91EF0D29AEA86FA6233249ECD754177A2345E71A0EB99B0999DADDF8E364397E0188EEAC97D70DE5169F6E3C2E4DDC6A0CD2D81DAB801E75D84098E5B98833F7F4FCC76E5C2715F1139AD45FEC59B144D97A3C745E57441360C2C0ECB76315979EA6EEA2A71BE9C96A58B9EB6D741F7818627BB9108171C156E7C8A9C2E2FCCF83B36BF3BC8540B70C98B3E153F12923CA03D4A7AE87084A7C765FD1C531D6E571D804BF7C733CEE1E38ED34016D9605E336500B154A3CB15D6B29EA72A4D0E1E1CBCB62A2AE2960C3DBB895989D2300C764F9DE972C72BD060AD4DD935A1822B4903CA1FF22A6F3670BF72BFBD9B71E24D0EB56D560CFCAF74FCEB7BC1C64DA76251ED99429694A435DF7DF36C2C0453078C4ED6DB4744FA88127AB0D02BCFB2F8A9DEAA9CE2D73495BDC05CB15AA7B738846F025121C7F721C58EEBE4DB29CCEA7EFBF8374FD522130B2216557170C46BEE5637F01F1DAC61112ABBB89FDB7C8B22270B5F1F7FC551334E5A05EF78C1C2B6D6817E7EBB98689255F99E4CFC4890B483931E4DCBD101506C01447B631F3D61A523246DCD1C915965719379906650CDE26FBC04D886E0262229A2B522BA0D8048FB2A91D1779E09586837FB6073ED150E0F02E928FE776C92B4CC065323D90EC60394B1A04E0E39B0E2A58F9E2CFA24E2AF6159EC49810F4B013F95E700AA3B84B4AA3992EC480C59CBD6F41AAF2775A5958F9BAA4ACAFD5EBDDF12389642EF0115D1FE8C36AD02EB2A7C08E9E0403CB3869EF4D14D3A25A9C295941819DCD6492C382553FF80EB66767CFCAA0A864A4C46B6D260357FC6F6331BA8AE6B5DF535E0DBE730AD21DF836D51C43B62F6EA8E8F99A6728D177B3C39318B8D47DCB041D12633451CCB2625E19158CFA6BCC38B83DB7408D755BA607619E19D8F5C1C838F490CBF4AA92C30FCD4D3A5DF42C60C6EA9B0C2673671029947BF3765645C1DC0AE25E3EA3C414B2A52AC6B72DD03754EC03841C71DCBF979A32EECC9015B85FE1AA317C9B84E14ED1569A0E2E3F7CC21243406BFAD57CB397E58F6A1BAD53B4FC50F8718264F60A285DEE789903C0E387E11D8EBD2A5A7693FD0E76F00E287FCB0BC3E5E98DA431375F4A83EDC82005D4977970F42FF15849835EF6BCEF47AF81482D42F221E21734CAB69807C7D0EEE5EB44D84BED63E8A212B73E066EC499BDFA1B37870AD32549E6F90F2D4ABE310A320DC2D91D826C8732EB997CDA5F16708B7D51BD049F3F68174250C98D953D0D69A311B5BD00C937249C2697FB5AE9757429CD12872DAD2AF67673FFE861034A4715262A7032E5BD196758FE54DDECC0C45020FC1E59E3CBA2870D62ABE760A55000092EF19BA61EA83D62536C2B0ED87F8104765EF1D6ED4E8649FB5FA6766C4A11CF7FAD385BAA352D1E0FD70F0021D4B01F39F031484CA119037E60379A6A8812EC4DBB2CDC1733C48A875B4DB08975B5460EAA790F9AE3F9F1501D9E93C5C260701B577A143E43A4F3344EC4B9B0DFFC7907DBAD5DD41ACCB156B823F63A2A0DB8717DE1AAFC77E8B342333A0E35DFA952F156886F104B7E3EEE26F5FD265E95059BC842FB90CE4E7B070ABC9CF5845BC903ABA5B803CA2EB66AC24357A91086FD8B1BAE20724E5BB872C7505A55C96125CB4D45F3614104BE4774F5D2D4AD5D5BA69D454FBA763AF79BF29A9AAB69E74A04BF56F10C9552D14B0AF00343AA1FA9ADF9D502974415C9CA65B981B5E088BA70F8419E73A8C8AA438506D0902EBBF6A05EA27BB9E405EEC6CFD778CEEC64F686BE0371BE7C7FBF5519ECFCEE24059311AE002BFDB289AEF9FA08C82880A4DE9E1A98A721F523B0791776E921279B48951EA2B9542FCFD9C37DC12205AF37B70C9B91D441F091EDA7F2C6FCBCE9DA6B0479E50778B546708DBCFD89A2F323D5C125583523C461B40BC7B692DD68D35BB6B4C43B683E463467C556C44500B6DA940108115492F31564B7173BB9483ED2418463E44C95DEA5B423D03272DF0985487FAC3FB4AD147D890386F84F95E54DFA323DEA876291F683A97E04CD0471D33295231643B6C1DBF4439F7AC5035CC33CE23843964CCC542B8B0387DE8156F68D46C075F0D92385CCD7F442FBC6348A18A85579BF65D9829471C08403F9223C5DEE617C0D62307FD3EDE885BAA1FA8F0E73D6BF74F9E3FDE7867123888B05E3A9AD1FF3CC154FB60884692D09FA93F992552610E05BA4B43D07FB5FC4EC36C8943ECCE3D5380E2159F6B96AE26DA26A71E3DCFD53B95AC96BF911D44BC4960C1DA53FCF6A849C3CDF584B691D6D5504652947D2304ACDEE871117322F14B794D36468D34EEB9EC175E941C134B1939DA3A141EB6D620A2689C07B7AF2743B2320B20FBFF5583583C593B79F365ED1F09C2D6726C52E0B025D6EAFC2B6A4E0A523D87DDB00398647579C081CCEF1E47D437FABEB597958287070386D031323C043BD149022867C6D575995F19B6C8BE718C9DCF9ACBBA4699946C06E91CA8B283DBBBBD3B4F9069AFD7FD60103B961E06B6304D1C229D76A2B9890614C3856A955FF68E6FD9AD0C96268FFE04A2231C50228FBFF5F53860C1E2E60597D7DC9DFD6A088D5AB429672E383F626B7595D53F183C3090E612639ED01EE108C9393A994E9CE0DE0AA146AD35037442602C3AE557061E279D3116505C61DB6AD070F0A6127B0359318F5CE98BAADBF83C5A09D9B3E2CFAA13A4FAE8068A0D92DD57BCE4E692730DF8250E6D09C32ACEE8DB08F014065E65F44F19001A9FE9EF97C1AA611AC3F3007CBB5115A13501B3603BB33DDFC63958AF728FD2E3AA159423A4986E537005A5F00F83BAD5BF5B07F1052B9A7AB803EEED931A5DB8A4AFCA45BFE4250598BE3C4C0237EBE83CD6C5C6457FE1309676BD071C461CDD3C45423D82F4515F041CBF048E7CA76FBD6D0831FEA283E06B32C3A537D844C562D955EAE9F05488F51321D6C043A0166E49F051A9204087934F80F3209D750C7F0928B1DC7FD52D888D0C36E82A4A030442930822C39B98C55F4D54FD2B63C9F558262306FC593EFB355EA3402D427AC136FA60FE1A2B1ECDFA5593A344E98783048F3844152E267AB016C7135B4BD708383D7DDA8C22B12707C704879728A226B81495C27027A1D4F3559158D9299D2579B8DDC855DCF7798B4C0CCFB5CA695E72515549E1777B66F6EDF5C4F947EF1956803A1FD24787B292A126B857D060C093CF17732153170DEFD475A2E50C494E3FBB3317B8B65EB0A87D21109C1013DBEAB98D0C8525110B6BE51902B761FB9552D257ADE7CF64A05865187616C4CBD6A116F273DF585D0DB8F0B18713CF3DCE197EB129C677B696BCF3EED0B7A3A521BC467F5FA684329FF8905B0BD388F35CCA4BDB91BB8E03834442338972D9420AF0DAF65B086506B712BCB1468BBBB301E1A59C402ACF4BBD20BE24C69C5D83EA178E0854CFDA11398300F5A285B951B806D5DD3E5CA93E65490C451402B25FC75D2D53663CB54CF7DF6A4A5554719F1B6D6382DEB30F5D4FB258A5481A1B02B5FE92D14154EFE1A93141DC6E6354B520161E2B82EB44A46AFFBA7C4D2F8FBE4EFD394BB5AD4214973157FFC079612636EF0723376944854D19F0E9F68738D52F3006E16431BE0517CBCAF28363498D02ADBE6E423568D36F0E6795ED04717541312A2B2B8916CF3C8F72CCAEEF61B8F856323A85D2266DFA5DF5F5D289DCC0BE2E6C505DDF8084C10591CB68800B6B2B736A4280A7933B1685C4A691A7D748727FB8400A63B4438E6C3AAFDBE79A794C2017330EAA9AD869F335D2D04522467FE5314162E11F70563C233542BEA28E3BEB3D3AB99FE53FD8A3A3503BACC444D756C84482B1E623E5F8AAA91720F401D58E7C094F8094D056923CC5B054C019CD44ACA4CA514573B583B8FF6D0C9659383D692A3589B2CE58DD72C80A3071FD434B64110F58E1F7E562403BA0167F7F58EC1F745021FB619DF9AB376318B410005D7299BD4305C5E08F438E999C4A74730CAE6700C6C4E2C9026D31AAC8D4ABCA7A5FCEC78BA6054AA5FFD0294E3D272138458E891415AD72E9E011759ACA10556B938DACF3FB1FEF725AA0A9E50017545A584D4539DF6699BE6B3843B114AE1A9AA5F1B0DA980A0422D4BAA36E8611AFB4B6FF6D8F12ED03CD98C646E0A1B34CC29D9D92326D233827211A58FD8F60E2CDF9EB143DFAB7CE7EFAD7F1539D18AFF3739B4A7C85ACCE493F57D44383238440307EF8702DDF94B36142FD0C44A17747F3AD191E400A1903196A3B0A46363745D5F08FD14F7D223D182557E00AC1C8612B8FA0E5EB49B3ED8AB6DF8FAAB24A172AEC45BEE11E3E47BBC5F267F0C86FA191B296F39E5B92AEF2C4553944ED77E4EF8869B6D5776CECBC352401ADA09BBA91D26231AE9A71B3B68BE1B8DF3575D5B3E40534F947773B17CD47B5500DC35896B8CE75815279BB2161DC5D53660ADA171D0A37761D588A7CEC15A130801CF69B999300EA9237EF93CB6FA90C46EA225E66036B74FC3AFAFCE1A0585E099A2A13AB11C33A7C3346363DEDD4F932EA3BC31FCCF8F4A0A015E9B8C1A2AD21D4E359BF5D6E852D9DA8B5129D60413DAC0B4D03CE113B76F176D02641DBDF2987764AB62AD5DAB3053AD17FE92E4DD0BB7CC1101FE853A115408F39BDF988FB765898D3B87C4176DA09FAAC45E052A1ADFE9E597FE51F79D3002B253DB892574474A0908784593A5ECECEEFAACCD6159B7B585AB2D106FD1F6A11654400E8DBB4473967B26F82690CF664A3C301E949DC5E0A17EA71BBAC1934FF6449F395529CF29FA6D9438637B20B1E8E6E5F68A215067B0B4DA6CED5605CB326BB0EC1C6D0F3F585B5C7BF6F1B23BCF5E0F5464CDDCE15A8D43018736862BEC0736E5A0760BA9179D205B265C3684FA28B065ED4ABC6DC7AFEB4AD6CFF6D3768B1DBAC5A5AA134F8559F672A50FCF472A8E1563380F96FEA6AF5A6238A142AE0F54771ECCFDEAD074B76D11FF2DC0E7BC8566E8E67EA23181609837380FAACF94A9743B8F3835FB8E8E3BF29F03D6E37EDA0FD0441B94B40DCC71834A71562BE68D81BF3807F10CD7FE1002D6B638225FFBAE96E69C4F1F737C4552C85BAC6C\"},\"acc\":1}`header={\"Connection\":\"close\",\"Qvia\":\"7d49dc636c8d4f7288233c98a55d697bb7d4e500\",\"REMOTE_ADD\":\"183.3.229.169\",\"X-Daa-Tunnel\":\"hop_count=2\",\"X-Forwarded-For\":\"125.73.220.99, 183.3.229.169\",\"X-Forwarded-Proto\":\"http\",\"X-NWS-LOG-UUID\":\"34f109c8-52e0-4ab4-82d3-61c65b8b6b04 9367589a0c7f3a1dccc749fc2fcb4e6c\",\"X-Real-IP\":\"183.3.229.169\",\"X-Tencent-Ua\":\"Qcloud\"}";

        Producer<String, String> producer = new KafkaProducer<String, String>(props);
        Future<RecordMetadata> ret = producer.send(new ProducerRecord<String, String>(topic, "1", msg));
        try {
            RecordMetadata recordMetadata = ret.get(10, TimeUnit.SECONDS);
            System.out.println(recordMetadata.offset());
            System.out.println(JSON.toJSONString(recordMetadata));

        } catch (InterruptedException e) {
            e.printStackTrace();
        } catch (ExecutionException e) {
            e.printStackTrace();
        } catch (TimeoutException e) {
            e.printStackTrace();
        }
        producer.close();
    }

    public static void test(String[] args) {


        Properties props = new Properties();
        props.put("bootstrap.servers", "172.17.6.186:9092");
        props.put("acks", "all");
        props.put("retries", 0);
        props.put("batch.size", 16384);
        props.put("linger.ms", 1);
        props.put("buffer.memory", 33554432);
        props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
        props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");

        Producer<String, String> producer = new KafkaProducer<String, String>(props);
        for (int i = 0; i < 10; i++) {
            producer.send(new ProducerRecord<String, String>("topic-zzh", Integer.toString(i), Integer.toString(i)));
        }
        producer.close();
    }
}
